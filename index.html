<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>
  <title>Train Scheduler</title>
</head>
<body>
	<div class="jumbotron">
  		<h1>It's time to go on an adventure</h1>
  		<p>Schedule your train ride here!</p>
	</div>
	<div class="panel panel-default">
  <!-- Default panel contents -->
  <div class="container">
	<div class="row">
		<div class="col-lg-12">
			<!-- Current Trains-->
			<div class="panel panel-default">
			  	<div class="panel-heading">
					<h3 class="panel-title"><strong>Current Train Schedule</strong></h3>
			  	</div>
			<div class="panel-body">
				<table class="table table-hover" id='train-table'>
				  	<thead>
						<tr>
							<th>Train Time</th>
							<th>Destination</th> 
							<th>Frequency (min)</th>
							<th>Next Arrival</th>
							<th>Minutes Away</th>
						</tr>
					</thead>
					<tbody>
					</tbody>
				</table>
				</div>
			</div>
        <!-- Wells for displaying all users -->
 
	<h2>Input Train Info!</h2>
	<div class=conatiner>
	<div class="input-group">
		Train Name
		<br>
  		<input type="text" id="nametext" placeholder="Username"></input>
	</div>
	
	<div class="input-group">
		Destination
		<br>
  		<input type="text" id="destinationtext" placeholder="Username"></input>
	</div>

	<div class="input-group">
		First Train Time 
		<br>
  		<input type="text" id="firsttext" placeholder="Username"></input>
	</div>

	<div class="input-group">
		Frequency (min)
		<br>
  		<input type="text" id="frequencytext" placeholder="Username"></input>
	</div>
	<button id="submitBtn" onclick="submitClick()">Submit</button>
	</div>
	</div>

	<script src="https://www.gstatic.com/firebasejs/4.8.0/firebase.js"></script>
		<script>
  // Initialize Firebase
  		var config = {
    		apiKey: "AIzaSyCI952Wnf0JJiQnta93Qqf52bhZ6euoOjw",
    		authDomain: "trainscheduler-21700.firebaseapp.com",
   			databaseURL: "https://trainscheduler-21700.firebaseio.com",
    		projectId: "trainscheduler-21700",
    		storageBucket: "trainscheduler-21700.appspot.com",
    		messagingSenderId: "608648764316"
  		};
  		firebase.initializeApp(config);
		
		var nameText = $("#nametext");	
		var destinationText = $("#destinationtext");
		var	firsttrainText = $("#firsttext");
		var frequencyText = $("#frequencytext");
		var submitBtn = $("#submitBtn");


		function submitClick(){
			event.preventDefault();

			var firebase = database.ref()

			var namevalue = nameText.val().trim();
			var destinationvalue = destinationText.val().trim();
			var firsttrainvalue = firsttrainText.val().trim();
			var frequencyvalue = frequencyText.val().trim();

			var newTrain = {
				name: namevalue,
				destination: destinationvalue,
				firsttrain: firsttrainvalue,
				frequency: frequencyvalue,
			};

			firebase.push(newTrain);
			

	  	
		}
		
		var database = firebase.database();
		database.ref().on("child_added", function(snapshot) {
      // Log everything that's coming out of snapshot
		var name = snapshot.val().name;
		var destination = snapshot.val().destination;
		var firsttrain = snapshot.val().firsttrain;
		var frequency = snapshot.val().frequency;

      	console.log(snapshot.val());
      	console.log(snapshot.val().name);
      	console.log(snapshot.val().destination);
      	console.log(snapshot.val().firsttrain);
      	console.log(snapshot.val().frequency);
      // Change the HTML to reflect
		
		var now = moment();
		var firsttraintime = moment(firsttrain,"hh:mm");
		var difference = now.diff((firsttraintime), "minutes");
		var remaining = difference % frequency;
		var minutesaway = frequency - remaining;
		var next = moment().add(minutesaway, "minutes");
		var nextarrival = moment(next).format("hh:mm a");

		//console.log(now);
		//console.log(firsttraintime);
		console.log(nextarrival);

		$("#train-table").find("tbody").append("<tr>"+"<td>" + name + "</td>" 
		+"<td>" + destination + "</td>" 
		+"<td>" + frequency + "</td>"
		+"<td>" + nextarrival + "</td>" 
		+"<td>" + minutesaway + "</td>"  
		+ "</tr>")
		
	});
	
		</script>
		
	</body>
</html>

